
import { supabase } from '@/integrations/supabase/client';

interface GenerateContentRequest {
  user_id: string | undefined;
  title: string;
  prompt: string;
  keywords: string;
  image_type: string;
  ai_image_style: string;
  content_language: string;
  content_style: string;
  content_type: string;
  video_enabled?: boolean;
  isRegeneration?: boolean;
}

export interface GeneratedContentResponse {
  content: string;
  imageUrl?: string;
  videoUrl?: string;
}

export const generateContent = async (data: GenerateContentRequest): Promise<GeneratedContentResponse> => {
  if (!data.user_id) {
    throw new Error('کاربر وارد نشده است');
  }

  // ایجاد درخواست در پایگاه داده
  const { data: contentRequest, error: insertError } = await supabase
    .from('content_requests')
    .insert({
      user_id: data.user_id,
      title: data.title,
      prompt: data.prompt,
      keywords: data.keywords,
      image_type: data.image_type,
      ai_image_style: data.ai_image_style,
      content_language: data.content_language,
      content_style: data.content_style,
      content_type: data.content_type,
      video_enabled: data.video_enabled || false,
      status: 'pending'
    })
    .select()
    .single();

  if (insertError) {
    console.error('Error inserting content request:', insertError);
    throw new Error('خطا در ایجاد درخواست');
  }

  // شبیه‌سازی تولید محتوا
  const simulatedContent = generateSimulatedContent(data);
  
  // به‌روزرسانی درخواست با محتوای تولید شده
  const { error: updateError } = await supabase
    .from('content_requests')
    .update({
      generated_content: simulatedContent.content,
      generated_image: simulatedContent.imageUrl,
      generated_video: simulatedContent.videoUrl,
      status: 'completed',
      updated_at: new Date().toISOString()
    })
    .eq('id', contentRequest.id);

  if (updateError) {
    console.error('Error updating content request:', updateError);
    throw new Error('خطا در به‌روزرسانی محتوا');
  }

  return simulatedContent;
};

// تابع شبیه‌سازی تولید محتوا
function generateSimulatedContent(data: GenerateContentRequest): GeneratedContentResponse {
  const keywords = data.keywords.split(',').map(k => k.trim()).filter(k => k);
  const keywordText = keywords.join('، ');
  
  const contentTemplates = {
    'article': generateArticleContent(data.title, data.prompt, keywordText, keywords),
    'social-media': generateSocialMediaContent(data.title, data.prompt, keywordText, keywords),
    'story': generateStoryContent(data.title, data.prompt, keywordText, keywords)
  };

  const content = contentTemplates[data.content_type as keyof typeof contentTemplates] || 
    contentTemplates['article'];

  const imageUrl = data.image_type !== 'no-image' 
    ? `https://picsum.photos/800/400?random=${Math.floor(Math.random() * 1000)}`
    : undefined;

  const videoUrl = data.video_enabled 
    ? `https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4?random=${Math.floor(Math.random() * 1000)}`
    : undefined;

  return {
    content,
    imageUrl,
    videoUrl
  };
}

function generateArticleContent(title: string, prompt: string, keywordText: string, keywords: string[]): string {
  const sections = [
    generateIntroduction(title, prompt, keywordText),
    generateMainContent(title, prompt, keywords),
    generateDetailedAnalysis(title, keywords),
    generatePracticalTips(title, keywords),
    generateCaseStudies(title, keywords),
    generateFutureOutlook(title, keywords),
    generateConclusion(title, prompt, keywordText)
  ];
  
  return `# ${title}

![${title}](https://picsum.photos/800/400?random=${Math.floor(Math.random() * 1000)})

${sections.join('\n\n')}

---

**نویسنده:** سیستم هوشمند تولید محتوا  
**تاریخ انتشار:** ${new Date().toLocaleDateString('fa-IR')}  
**کلمات کلیدی:** ${keywordText}`;
}

function generateIntroduction(title: string, prompt: string, keywordText: string): string {
  return `## مقدمه

در عصر دیجیتال امروز، موضوع ${title} به یکی از مهم‌ترین مباحث تبدیل شده است که توجه گسترده‌ای از سوی متخصصان، پژوهشگران و علاقه‌مندان را به خود جلب کرده است. ${prompt} نه تنها به عنوان یک موضوع علمی و تخصصی مطرح است، بلکه تأثیرات عمیقی بر جنبه‌های مختلف زندگی اجتماعی، اقتصادی و فرهنگی ما دارد.

این مقاله با نگاهی جامع و تحلیلی به بررسی ابعاد مختلف ${keywordText} می‌پردازد و تلاش می‌کند تا تصویری کامل و علمی از این موضوع مهم ارائه دهد. هدف ما از نگارش این مطلب، فراهم آوردن منبعی معتبر و کاربردی است که بتواند پاسخگوی نیازهای اطلاعاتی مخاطبان در زمینه‌های مختلف باشد.

با توجه به پیچیدگی و گستردگی موضوع، این مقاله در بخش‌های مختلفی تنظیم شده است که هر کدام به جنبه خاصی از ${title} می‌پردازد. از تعاریف بنیادین گرفته تا کاربردهای عملی و چشم‌انداز آینده، تمامی جوانب مهم این موضوع مورد بحث و بررسی قرار خواهد گرفت.`;
}

function generateMainContent(title: string, prompt: string, keywords: string[]): string {
  const keywordSections = keywords.slice(0, 3).map((keyword, index) => 
    `### ${index + 1}. بررسی ${keyword}

${keyword} به عنوان یکی از مؤلفه‌های کلیدی ${title} نقش بسیار مهمی ایفا می‌کند. تحقیقات انجام شده نشان می‌دهد که درک صحیح این مفهوم برای هر فردی که در این حوزه فعالیت می‌کند، ضروری است.

از منظر تاریخی، ${keyword} همواره مورد توجه محققان و متخصصان بوده است. در دهه‌های گذشته، تحولات چشمگیری در این زمینه رخ داده که منجر به تغییرات اساسی در رویکردها و روش‌های کاری شده است.

مطالعات میدانی نیز نشان می‌دهند که ${keyword} تأثیر مستقیمی بر عملکرد کلی سیستم دارد. این تأثیر نه تنها در جنبه‌های فنی قابل مشاهده است، بلکه در ابعاد اجتماعی و اقتصادی نیز نمود پیدا می‌کند.

برای درک بهتر این موضوع، باید به عوامل مؤثر بر ${keyword} اشاره کرد. این عوامل شامل متغیرهای محیطی، فناوری‌های نوظهور، و تغییرات در ترجیحات کاربران است که هر کدام به نوبه خود تأثیرات خاصی بر روند کلی دارند.`
  ).join('\n\n');

  return `## بحث و بررسی تخصصی

${prompt} در بافت امروزی دنیا، ضرورتی اجتناب‌ناپذیر محسوب می‌شود. پیشرفت‌های تکنولوژیکی و تغییرات اجتماعی موجب شده است تا این موضوع از زاویه‌های جدیدی مورد بررسی قرار گیرد.

${keywordSections}

### نگاه جامع به موضوع

اگر بخواهیم ${title} را در یک چارچوب جامع بررسی کنیم، باید به سه بعد اصلی توجه کنیم: بعد نظری، بعد عملی و بعد آینده‌پژوهانه. هر یک از این ابعاد دارای ویژگی‌ها و الزامات خاص خود هستند که درک آنها برای موفقیت در این حوزه ضروری است.

از نظر نظری، ${title} بر پایه اصول و قوانین علمی استوار است که طی سال‌ها تحقیق و بررسی شکل گرفته‌اند. این اصول نه تنها راهنمای عمل هستند، بلکه چارچوبی برای درک بهتر پدیده‌های پیچیده فراهم می‌آورند.`;
}

function generateDetailedAnalysis(title: string, keywords: string[]): string {
  return `## تحلیل عمیق و بررسی جزئیات

برای درک کامل ${title}، لازم است به تحلیل دقیق‌تری از مؤلفه‌های آن بپردازیم. این بخش تلاش می‌کند تا با نگاهی علمی و منطقی، لایه‌های پنهان این موضوع را آشکار سازد.

### عوامل تأثیرگذار اصلی

یکی از مهم‌ترین جنبه‌های بررسی ${title} شناخت عوامل تأثیرگذار بر آن است. این عوامل را می‌توان در دسته‌بندی‌های مختلفی قرار داد:

**عوامل درونی:** این دسته از عوامل مستقیماً از درون سیستم نشأت می‌گیرند و شامل ویژگی‌های ذاتی، قابلیت‌های موجود و محدودیت‌های ساختاری می‌شوند. درک این عوامل برای بهینه‌سازی عملکرد کلی سیستم ضروری است.

**عوامل بیرونی:** محیط پیرامون نیز تأثیر بسزایی بر ${title} دارد. تغییرات اقلیمی، شرایط اقتصادی، سیاست‌های دولتی و حتی تحولات فرهنگی از جمله عوامل بیرونی محسوب می‌شوند که باید در تحلیل‌ها مدنظر قرار گیرند.

### روش‌های تحلیل و ارزیابی

برای تحلیل علمی ${title}، روش‌های مختلفی وجود دارد که هر کدام مزایا و محدودیت‌های خاص خود را دارند:

1. **تحلیل کمّی:** استفاده از داده‌های عددی و آماری برای اندازه‌گیری و مقایسه
2. **تحلیل کیفی:** بررسی جنبه‌های غیرقابل اندازه‌گیری اما مهم موضوع
3. **تحلیل ترکیبی:** ادغام روش‌های کمّی و کیفی برای دستیابی به نتایج جامع‌تر

### چالش‌ها و فرصت‌ها

هر موضوعی دارای چالش‌ها و فرصت‌هایی است که ${title} نیز از این قاعده مستثنی نیست. شناخت این چالش‌ها و فرصت‌ها می‌تواند در تصمیم‌گیری‌های آینده نقش مهمی ایفا کند.

از جمله مهم‌ترین چالش‌ها می‌توان به پیچیدگی متغیرها، نیاز به تخصص بالا، و محدودیت‌های منابع اشاره کرد. در مقابل، فرصت‌هایی نظیر پیشرفت‌های تکنولوژیکی، افزایش آگاهی عمومی، و حمایت‌های نهادی نیز وجود دارند که می‌توانند مسیر پیشرفت را هموار سازند.`;
}

function generatePracticalTips(title: string, keywords: string[]): string {
  const tips = keywords.slice(0, 5).map((keyword, index) => 
    `**${index + 1}. بهینه‌سازی ${keyword}:**  
برای دستیابی به نتایج بهتر در زمینه ${keyword}، توصیه می‌شود از روش‌های نوین و علمی استفاده کرد. تجربه نشان داده که ترکیب دانش نظری با کاربرد عملی بهترین نتایج را به همراه دارد.`
  ).join('\n\n');

  return `## راهنمای عملی و نکات کاربردی

یکی از مهم‌ترین جنبه‌های هر بحث علمی، قابلیت تبدیل دانش نظری به کاربرد عملی است. در این بخش، تلاش می‌کنیم تا راهکارهای عملی و قابل اجرایی برای ${title} ارائه دهیم.

### نکات کلیدی برای پیاده‌سازی

${tips}

### مراحل اجرای عملی

برای پیاده‌سازی موفق ${title}، پیشنهاد می‌شود مراحل زیر به ترتیب انجام شوند:

**مرحله اول: برنامه‌ریزی و طراحی**  
در این مرحله، اهداف کلی مشخص شده و برنامه جامعی برای دستیابی به آنها تدوین می‌شود. اهمیت این مرحله در این است که پایه و اساس تمامی فعالیت‌های بعدی را تشکیل می‌دهد.

**مرحله دوم: آماده‌سازی منابع**  
تأمین منابع مورد نیاز شامل منابع انسانی، مالی، فنی و اطلاعاتی از ضروریات این مرحله محسوب می‌شود. بدون آماده‌سازی مناسب منابع، امکان اجرای موفق پروژه بسیار کاهش می‌یابد.

**مرحله سوم: اجرای تدریجی**  
بهتر است اجرا به صورت تدریجی و مرحله‌ای انجام شود تا امکان نظارت، کنترل و اصلاح در صورت نیاز فراهم باشد. این روش همچنین امکان یادگیری از تجربیات هر مرحله را نیز فراهم می‌آورد.

**مرحله چهارم: نظارت و ارزیابی**  
نظارت مستمر بر روند اجرا و ارزیابی دوره‌ای نتایج، از عوامل کلیدی موفقیت محسوب می‌شوند. این مرحله امکان شناسایی نقاط قوت و ضعف و انجام اصلاحات لازم را فراهم می‌آورد.

### اشتباهات رایج و راه‌های جلوگیری از آنها

تجربه نشان داده که در پیاده‌سازی ${title} اشتباهات رایجی رخ می‌دهد که با شناخت آنها می‌توان از تکرار آنها جلوگیری کرد:

- عدم برنامه‌ریزی کافی در مراحل اولیه
- نادیده گرفتن عوامل محیطی و بیرونی
- عدم تخصیص منابع کافی برای مراحل مختلف
- نبود سیستم نظارت و کنترل مناسب
- عدم انعطاف‌پذیری در برابر تغییرات غیرمنتظره`;
}

function generateCaseStudies(title: string, keywords: string[]): string {
  return `## مطالعات موردی و تجربیات عملی

برای درک بهتر کاربردهای عملی ${title}، بررسی مطالعات موردی و تجربیات واقعی بسیار مفید است. این بخش به تحلیل چند نمونه موفق و ناموفق می‌پردازد.

### نمونه موفق اول: پیاده‌سازی در محیط شهری

یکی از موفق‌ترین نمونه‌های اجرای ${title} در محیط شهری انجام شد. این پروژه با هدف بهبود کیفیت زندگی شهروندان آغاز شد و طی دو سال به نتایج قابل توجهی دست یافت.

**عوامل موفقیت:**
- برنامه‌ریزی جامع و دقیق از همان آغاز
- مشارکت فعال تمامی ذی‌نفعان
- استفاده از تکنولوژی‌های روز دنیا
- نظارت مستمر و ارزیابی دوره‌ای

**نتایج حاصله:**
- افزایش ۴۵ درصدی رضایت شهروندان
- کاهش ۳۰ درصدی مشکلات مربوطه
- بهبود شاخص‌های کلیدی عملکرد
- ایجاد الگویی قابل تکرار برای سایر مناطق

### نمونه موفق دوم: کاربرد در صنعت

در حوزه صنعتی نیز نمونه‌های موفقی از اجرای ${title} وجود دارد. یکی از این نمونه‌ها در یک شرکت بزرگ تولیدی اجرا شد و نتایج بسیار مثبتی به همراه داشت.

این پروژه با چالش‌های خاصی روبه‌رو بود که شامل مقاومت کارکنان، محدودیت‌های بودجه، و پیچیدگی فرآیندهای موجود می‌شد. با این حال، با اجرای استراتژی مناسب این چالش‌ها به فرصت‌هایی برای بهبود تبدیل شدند.

### درس‌های آموخته شده

از بررسی این مطالعات موردی، درس‌های مهمی می‌توان آموخت:

1. **اهمیت آمادگی سازمانی:** قبل از شروع هر پروژه، باید سطح آمادگی سازمان ارزیابی شود
2. **ضرورت مدیریت تغییر:** تغییرات اجتماعی و فرهنگی زمان بیشتری نسبت به تغییرات فنی نیاز دارند
3. **نقش رهبری:** وجود رهبری قوی و متعهد یکی از مهم‌ترین عوامل موفقیت است
4. **اهمیت ارتباطات:** برقراری ارتباط مؤثر با تمامی ذی‌نفعان از ضروریات اجرای موفق است

### تحلیل نمونه‌های ناموفق

علاوه بر نمونه‌های موفق، بررسی موارد ناموفق نیز آموزنده است. یکی از این موارد به دلیل عدم برنامه‌ریزی مناسب و نادیده گرفتن عوامل محیطی با شکست مواجه شد.

عوامل اصلی شکست این پروژه عبارت بودند از:
- عدم مطالعه کافی در مرحله طراحی
- نبود حمایت مدیریت ارشد
- تخصیص ناکافی منابع
- عدم توجه به مقاومت‌های طبیعی در برابر تغییر`;
}

function generateFutureOutlook(title: string, keywords: string[]): string {
  return `## چشم‌انداز آینده و روندهای نوظهور

بررسی آینده ${title} و پیش‌بینی روندهای احتمالی، نه تنها برای درک بهتر موضوع مفید است، بلکه برای تصمیم‌گیری‌های استراتژیک نیز ضروری به نظر می‌رسد.

### تحولات تکنولوژیکی آینده

یکی از مهم‌ترین عوامل تأثیرگذار بر آینده ${title}، پیشرفت‌های تکنولوژیکی است. انتظار می‌رود که تکنولوژی‌های نوظهور تغییرات بنیادینی در این حوزه ایجاد کنند.

**هوش مصنوعی و یادگیری ماشین:**  
استفاده از الگوریتم‌های پیشرفته هوش مصنوعی می‌تواند فرآیندهای سنتی را متحول کند و امکانات جدیدی فراهم آورد. این تکنولوژی‌ها قابلیت تحلیل داده‌های پیچیده و ارائه راهکارهای بهینه را دارند.

**اینترنت اشیا (IoT):**  
اتصال دستگاه‌ها و سیستم‌ها به یکدیگر، امکان نظارت و کنترل هوشمند را فراهم می‌آورد. این امر منجر به بهبود کارایی و کاهش هزینه‌ها خواهد شد.

**فناوری بلاک‌چین:**  
استفاده از این فناوری می‌تواند شفافیت، امنیت و اعتماد را در فرآیندهای مختلف افزایش دهد.

### تغییرات اجتماعی و فرهنگی

علاوه بر تحولات تکنولوژیکی، تغییرات اجتماعی و فرهنگی نیز تأثیر بسزایی بر آینده ${title} خواهند داشت:

- افزایش آگاهی عمومی نسبت به اهمیت موضوع
- تغییر در ترجیحات و انتظارات مردم
- ظهور نسل جدیدی از کاربران با نیازهای متفاوت
- تأکید بیشتر بر پایداری و مسئولیت اجتماعی

### چالش‌های آینده

با وجود فرصت‌های فراوان، چالش‌هایی نیز در انتظار آینده ${title} قرار دارند:

**چالش‌های فنی:**
- پیچیدگی فزاینده سیستم‌ها
- نیاز به تخصص‌های جدید
- مسائل امنیتی و حریم خصوصی

**چالش‌های اقتصادی:**
- نیاز به سرمایه‌گذاری‌های گسترده
- عدم قطعیت در بازده سرمایه‌گذاری‌ها
- رقابت شدید در بازارهای جهانی

**چالش‌های اجتماعی:**
- مقاومت در برابر تغییرات
- نابرابری در دسترسی به امکانات
- نیاز به آموزش و توانمندسازی نیروی انسانی

### راهبردهای آماده‌سازی برای آینده

برای آماده‌سازی در برابر تحولات آینده، راهبردهای زیر پیشنهاد می‌شوند:

1. **سرمایه‌گذاری در تحقیق و توسعه:** توسعه قابلیت‌های نوآوری و خلاقیت
2. **توسعه نیروی انسانی:** آموزش و توانمندسازی مداوم کارکنان
3. **ایجاد شراکت‌های استراتژیک:** همکاری با سازمان‌ها و نهادهای مختلف
4. **انعطاف‌پذیری سازمانی:** ایجاد ساختارهای قابل تطبیق با تغییرات سریع`;
}

function generateConclusion(title: string, prompt: string, keywordText: string): string {
  return `## نتیجه‌گیری و جمع‌بندی

پس از بررسی جامع و تحلیل دقیق موضوع ${title}، می‌توان به نتایج مهمی دست یافت که در ادامه به آنها اشاره می‌کنیم.

### نکات کلیدی

بررسی‌های انجام شده نشان می‌دهد که ${prompt} دارای ابعاد گسترده و پیچیده‌ای است که درک و مدیریت آن نیاز به نگاهی جامع و میان‌رشته‌ای دارد. ${keywordText} به عنوان عناصر کلیدی این موضوع، نقش بسیار مهمی در تعیین مسیر و جهت‌گیری‌های آینده ایفا می‌کنند.

### دستاوردهای مقاله

این مقاله تلاش کرده است تا:

- **تصویری جامع** از وضعیت کنونی ${title} ارائه دهد
- **تحلیل علمی** از عوامل تأثیرگذار و روابط بین آنها انجام دهد
- **راهکارهای عملی** برای پیاده‌سازی و بهره‌برداری بهینه ارائه نماید
- **چشم‌اندازی روشن** از آینده و تحولات احتمالی فراهم کند

### توصیه‌های کاربردی

بر اساس یافته‌های این مطالعه، توصیه‌های زیر برای ذی‌نفعان و علاقه‌مندان ارائه می‌شود:

**برای سیاست‌گذاران:**
- ایجاد چارچوب‌های قانونی و نظارتی مناسب
- تسهیل فرآیندهای اجرایی و کاهش موانع بوروکراتیک
- حمایت از تحقیق و توسعه در این حوزه

**برای محققان و دانشگاهیان:**
- انجام مطالعات بیشتر در زمینه‌های کم‌کاوی
- همکاری میان‌رشته‌ای برای حل مسائل پیچیده
- انتشار یافته‌ها و تبادل دانش با جامعه علمی

**برای فعالان صنعتی:**
- سرمایه‌گذاری در فناوری‌های نوین
- توسعه شراکت‌های استراتژیک
- توجه بیشتر به نیازها و انتظارات مشتریان

### نگاه به آینده

آینده ${title} وابسته به تصمیمات و اقداماتی است که امروز انجام می‌دهیم. با توجه به سرعت تغییرات در دنیای امروز، ضروری است که رویکردهای سنتی را بازنگری کرده و راهکارهای نوآورانه‌ای اتخاذ کنیم.

امید است که این مقاله بتواند سهمی در ارتقای دانش و آگاهی عمومی نسبت به ${title} داشته باشد و زمینه‌ساز تحقیقات و فعالیت‌های بیشتر در این حوزه مهم گردد.

**در پایان، تأکید می‌کنیم که موفقیت در این مسیر نیازمند همکاری و تعامل همه ذی‌نفعان است و تنها با تلاش جمعی می‌توان به اهداف مطلوب دست یافت.**`;
}

function generateSocialMediaContent(title: string, prompt: string, keywordText: string, keywords: string[]): string {
  const hashtags = keywords.map(k => `#${k.replace(/\s+/g, '_')}`).join(' ');
  const tips = keywords.slice(0, 6).map((keyword, index) => 
    `${index + 1}️⃣ **${keyword}**: یکی از مهم‌ترین عوامل موفقیت که نباید نادیده گرفته شود`
  ).join('\n');

  return `🌟 **${title}** 🌟

![${title}](https://picsum.photos/600/600?random=${Math.floor(Math.random() * 1000)})

${prompt} موضوعی است که امروزه توجه بسیاری را به خود جلب کرده است. 

✨ **چرا این موضوع مهم است؟**

در دنیای پرسرعت امروز، درک صحیح از این موضوع می‌تواند تفاوت زیادی در نتایج ایجاد کند. ${keywordText} عناصری هستند که نقش کلیدی در موفقیت ایفا می‌کنند.

🎯 **نکات کلیدی:**

${tips}

💡 **نکته مهم:** تجربه نشان داده که ترکیب صحیح این عوامل می‌تواند نتایج شگفت‌انگیزی به همراه داشته باشد.

📈 **آمار جالب:** بر اساس آخرین تحقیقات، افرادی که به این موضوع توجه ویژه می‌کنند، ۷۵٪ موفق‌تر از دیگران عمل می‌کنند.

🔥 **اکشن پلن:**
• ابتدا اهداف خود را مشخص کنید
• برنامه‌ریزی دقیق انجام دهید  
• عملکرد خود را مرتب ارزیابی کنید
• از تجربیات دیگران استفاده کنید

🌈 **پیام نهایی:** موفقیت در ${title} نیازمند صبر، پشتکار و استراتژی صحیح است. با برنامه‌ریزی مناسب و اجرای دقیق، همه چیز ممکن است!

👈 نظرتان درباره این موضوع چیست؟ در کامنت‌ها با ما در میان بگذارید!

${hashtags} #موفقیت #استراتژی #توسعه_فردی #محتوای_آموزشی #تجربه_کاربری`;
}

function generateStoryContent(title: string, prompt: string, keywordText: string, keywords: string[]): string {
  const characters = keywords.slice(0, 3);
  const setting = keywords[3] || 'دنیایی مرموز';
  
  return `# ${title}

![صحنه‌ای از داستان](https://picsum.photos/700/400?random=${Math.floor(Math.random() * 1000)})

## فصل اول: آغاز ماجراجویی

روزی روزگاری، در ${setting} که ${prompt}، داستانی شگفت‌انگیز آغاز شد. این سرزمین پر از رازها و معماهایی بود که تنها افراد شجاع و باهوش می‌توانستند آنها را حل کنند.

قهرمان داستان ما، فردی جوان و پرانرژی بود که همیشه به دنبال ماجراجویی‌های جدید می‌گشت. او در دل خود حس می‌کرد که برای کارهای بزرگی آفریده شده است.

## فصل دوم: ملاقات با شخصیت‌های کلیدی

در مسیر خود، قهرمان ما با شخصیت‌هایی آشنا شد که هر کدام نماینده ${keywordText} بودند:

**${characters[0] || 'رهنمای خردمند'}**: این شخصیت با تجربه و دانش فراوان، راهنمای قهرمان در مسیر پرپیچ و خم زندگی بود. او همیشه یادآور می‌شد که "دانش بدون عمل، مانند چراغی است که در جعبه نگهداری شود."

**${characters[1] || 'یار وفادار'}**: دوست صمیمی قهرمان که در تمام مراحل دشوار کنارش بود. این شخصیت نشان می‌داد که قدرت دوستی واقعی می‌تواند کوه‌ها را جابه‌جا کند.

**${characters[2] || 'چالش‌آفرین'}**: موجودی مرموز که همیشه مانعی در مسیر قهرمان ایجاد می‌کرد، اما در عین حال به او یاد می‌داد که چگونه از موانع عبور کند.

## فصل سوم: مواجهه با چالش بزرگ

هنگامی که قهرمان فکر می‌کرد همه چیز کنترل است، با چالشی بزرگ مواجه شد. این چالش آنقدر عظیم بود که تمام توانایی‌ها و مهارت‌هایی که تا آن زمان فراگرفته بود، به کار گیرد.

در این لحظه حساس، قهرمان متوجه شد که تنها راه عبور از این چالش، استفاده هوشمندانه از تمام عناصر ${keywordText} است. هر کدام از این عناصر مانند قطعه‌ای از پازل بودند که باید در جای درست قرار می‌گرفتند.

## فصل چهارم: کشف راز بزرگ

پس از مبارزه‌ای طولانی و پرفراز و نشیب، قهرمان بالاخره راز بزرگ را کشف کرد. این راز چیزی نبود جز درک این حقیقت که ${prompt} تنها زمانی معنا پیدا می‌کند که با قلبی پاک و نیت خالص دنبال شود.

او فهمید که تمام ماجراجویی‌ها و چالش‌هایی که با آنها مواجه شده بود، درواقع مراحل یادگیری و رشد شخصی او بوده‌اند. هر قدم او را به سمت درک بهتر خودش و دنیای اطرافش هدایت می‌کرد.

## فصل پنجم: بازگشت و تحول

وقتی قهرمان به خانه بازگشت، دیگر همان فرد سابق نبود. او حالا حکیمی بود که تجربیات ارزشمندی کسب کرده بود. مردم به او مراجعه می‌کردند تا از دانش و تجربه‌اش استفاده کنند.

قهرمان با خوشحالی تجربیات خود را با دیگران در میان می‌گذاشت و یادشان می‌داد که هر فردی قابلیت انجام کارهای شگفت‌انگیز را دارد، فقط باید شجاعت آغاز کردن را داشته باشد.

## پایان: پیامی برای آینده

این داستان با پیامی امیدوارکننده پایان می‌یابد: ${title} تنها یک مقصد نیست، بلکه سفری است که هرگز تمام نمی‌شود. هر روز فرصت جدیدی برای یادگیری، رشد و کمک به دیگران فراهم می‌آورد.

**درس اصلی داستان:** گاهی اوقات مهم‌ترین کشفیات در درون خود ما نهفته است، فقط باید شجاعت کاوش در آن را داشته باشیم.

*و آنها تا ابد در سعادت و خوشی زندگی کردند، همیشه آماده ماجراجویی‌های جدید و یادگیری‌های تازه.*`;
}

export const getUserContentHistory = async (userId: string) => {
  const { data, error } = await supabase
    .from('content_requests')
    .select('*')
    .eq('user_id', userId)
    .order('created_at', { ascending: false })
    .limit(10);

  if (error) {
    console.error('Error fetching user history:', error);
    throw new Error('خطا در بارگذاری تاریخچه');
  }

  return data || [];
};
